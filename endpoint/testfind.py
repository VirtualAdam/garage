import subprocess
import time
import nmap

nm = nmap.PortScanner()
results = nm.scan('192.168.1.*', '1883')
for item in results['scan']:
    if results['scan'][item]['tcp'][1883]['state'] == 'open':
        output = item
        print output


#    print item['tcp'][1883]['state']
#output = subprocess.Popen(["nmap", "-sP",'192.168.1.*'], stdout=subprocess.PIPE).communicate()[0]
#out = output.split('/n')
#print out[0]
#fast = {'nmap': {'scanstats': {'uphosts': '19', 'timestr': 'Tue Jul 31 19:29:23 2018', 'downhosts': '237', 'totalhosts': '256', 'elapsed': '33.18'}, 'scaninfo': {'tcp': {'services': '1883', 'method': 'syn'}}, 'command_line': 'nmap -oX - -p 1883 -sV 192.168.1.*'}, 'scan': {'192.168.1.26': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {}, 'addresses': {'mac': '00:71:47:20:11:75', 'ipv4': '192.168.1.26'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.19': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'B8:E9:37:BF:0A:B0': 'Sonos'}, 'addresses': {'mac': 'B8:E9:37:BF:0A:B0', 'ipv4': '192.168.1.19'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.13': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'18:B4:30:85:F1:10': 'Nest Labs'}, 'addresses': {'mac': '18:B4:30:85:F1:10', 'ipv4': '192.168.1.13'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.12': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'18:B4:30:DE:E0:23': 'Nest Labs'}, 'addresses': {'mac': '18:B4:30:DE:E0:23', 'ipv4': '192.168.1.12'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.11': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'18:B4:30:DE:E4:C6': 'Nest Labs'}, 'addresses': {'mac': '18:B4:30:DE:E4:C6', 'ipv4': '192.168.1.11'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.10': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'F0:D5:BF:73:FB:86': 'Intel Corporate'}, 'addresses': {'mac': 'F0:D5:BF:73:FB:86', 'ipv4': '192.168.1.10'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.17': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {}, 'addresses': {'mac': 'FC:A1:83:A5:C7:CD', 'ipv4': '192.168.1.17'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.16': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'2C:20:0B:D1:26:CB': 'Apple'}, 'addresses': {'mac': '2C:20:0B:D1:26:CB', 'ipv4': '192.168.1.16'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.15': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {}, 'addresses': {'mac': '6C:56:97:FF:D8:6D', 'ipv4': '192.168.1.15'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.14': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'18:B4:30:01:7A:FE': 'Nest Labs'}, 'addresses': {'mac': '18:B4:30:01:7A:FE', 'ipv4': '192.168.1.14'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.7': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'40:B4:CD:28:B0:16': 'Amazon Technologies'}, 'addresses': {'mac': '40:B4:CD:28:B0:16', 'ipv4': '192.168.1.7'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.6': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'B8:27:EB:F3:91:F3': 'Raspberry Pi Foundation'}, 'addresses': {'mac': 'B8:27:EB:F3:91:F3', 'ipv4': '192.168.1.6'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.5': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {}, 'addresses': {'mac': 'C8:3A:6B:54:20:AF', 'ipv4': '192.168.1.5'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.4': {'status': {'state': 'up', 'reason': 'localhost-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {}, 'addresses': {'ipv4': '192.168.1.4'}, 'tcp': {1883: {'product': '', 'state': 'open', 'version': '', 'name': 'mosquitto version 1.4.10', 'conf': '10', 'extrainfo': '', 'reason': 'syn-ack', 'cpe': ''}}}, '192.168.1.3': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'B0:EE:7B:71:D8:49': 'Roku'}, 'addresses': {'mac': 'B0:EE:7B:71:D8:49', 'ipv4': '192.168.1.3'}, 'tcp': {1883: {'product': '', 'state': 'filtered', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'no-response', 'cpe': ''}}}, '192.168.1.2': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'00:21:B7:32:A5:57': 'Lexmark International'}, 'addresses': {'mac': '00:21:B7:32:A5:57', 'ipv4': '192.168.1.2'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.1': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'B0:7F:B9:93:1B:D5': 'Netgear'}, 'addresses': {'mac': 'B0:7F:B9:93:1B:D5', 'ipv4': '192.168.1.1'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.9': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'18:B4:30:DF:5D:69': 'Nest Labs'}, 'addresses': {'mac': '18:B4:30:DF:5D:69', 'ipv4': '192.168.1.9'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}, '192.168.1.8': {'status': {'state': 'up', 'reason': 'arp-response'}, 'hostnames': [{'type': '', 'name': ''}], 'vendor': {'30:8C:FB:AA:08:00': 'Dropcam'}, 'addresses': {'mac': '30:8C:FB:AA:08:00', 'ipv4': '192.168.1.8'}, 'tcp': {1883: {'product': '', 'state': 'closed', 'version': '', 'name': 'mqtt', 'conf': '3', 'extrainfo': '', 'reason': 'reset', 'cpe': ''}}}}}
#print results['scan']['192.168.1.6']['tcp'][1883]['state']